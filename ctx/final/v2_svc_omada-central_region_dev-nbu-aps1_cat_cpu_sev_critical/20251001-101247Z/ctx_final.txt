### AIOps reusable context
- service: omada-central
- region: dev-nbu-aps1
- category: cpu
- severity: critical
- title: omada-central container CPU usage is too high
- duration: 15m
- window: 5m
- threshold: 0.9

#### SOP (selected)
### [SOP] Preloaded knowledge (high priority)
#### CPU å‘Šè­¦å¤„ç†
- Precheck: ä½¿ç”¨ victoriametrics MCP æŸ¥è¯¢: sum(rate(container_cpu_usage_seconds_total{container!="POD",container!="", container!="istio-proxy", image!="",pod=~"omada-central.*", namespace=~"sdn5"}[5m])) by (pod, container) / sum(kube_pod_container_resource_limits{container!="POD",pod=~"omada-central.*", namespace=~"sdn5", resource="cpu"} > 0) by (pod, container)>0.9 (å‘Šè­¦è‡ªå¸¦è¡¨è¾¾å¼)
- Precheck: ä½¿ç”¨ awslabseks_mcp_server æ£€æŸ¥ Pod çŠ¶æ€å’Œèµ„æºé™åˆ¶
- Action: 1. æ‰©å®¹ Pod æ•°é‡
- Action: 2. å¢žåŠ  CPU èµ„æºé™åˆ¶
- Action: 3. æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸è¿›ç¨‹
- Note: CPU ä½¿ç”¨çŽ‡è¿‡é«˜æ—¶çš„å¤„ç†æ­¥éª¤
#### CloudWatch æŒ‡æ ‡æ£€æŸ¥
- Precheck: ä½¿ç”¨ awslabscloudwatch_mcp_server æŸ¥çœ‹ AWS èµ„æºæŒ‡æ ‡
- Action: 1. å¯¹æ¯” CloudWatch å’Œ K8s æŒ‡æ ‡
- Action: 2. æ£€æŸ¥ AWS èµ„æºå¥åº·çŠ¶å†µ
- Action: 3. åˆ†æžè·¨äº‘æŒ‡æ ‡å·®å¼‚
- Note: CloudWatch æŒ‡æ ‡ç›‘æŽ§å’Œå¯¹æ¯”

#### Model Output (cleaned)
I'll analyze this CPU alert for the omada-central container by executing the necessary prechecks and gathering comprehensive data.


ðŸ› ï¸  Using tool: query (trusted) from mcp server victoriametrics
 â‹® 
 â— Running query with the param:
 â‹®  {
 â‹®    "query": "sum(rate(container_cpu_usage_seconds_total{container!=\"POD\",container!=\"\", container!=\"istio-proxy\", image!=\"\",pod=~\"omada-central.*\", namespace=~\"sdn5\"}[5m])) by (pod, container) / sum(kube_pod_container_resource_limits{container!=\"POD\",pod=~\"omada-central.*\", namespace=~\"sdn5\", resource=\"cpu\"} > 0) by (pod, container)"
 â‹®  }

 â‹® 
 â— Completed in 0.7s




ðŸ› ï¸  Using tool: query (trusted) from mcp server victoriametrics
 â‹® 
 â— Running query with the param:
 â‹®  {
 â‹®    "query": "container_cpu_usage_seconds_total{container!=\"POD\",container!=\"\", container!=\"istio-proxy\", image!=\"\",pod=~\"omada-central.*\", namespace=~\"sdn5\"}"
 â‹®  }

 â‹® 
 â— Completed in 0.7s




ðŸ› ï¸  Using tool: query (trusted) from mcp server victoriametrics
 â‹® 
 â— Running query with the param:
 â‹®  {
 â‹®    "query": "kube_pod_container_resource_limits{container!=\"POD\",pod=~\"omada-central.*\", namespace=~\"sdn5\", resource=\"cpu\"}"
 â‹®  }

 â‹® 
 â— Completed in 0.28s




ðŸ› ï¸  Using tool: query (trusted) from mcp server victoriametrics
 â‹® 
 â— Running query with the param:
 â‹®  {
 â‹®    "query": "up{job=~\".*omada.*\"}"
 â‹®  }

 â‹® 
 â— Completed in 0.158s




ðŸ› ï¸  Using tool: query (trusted) from mcp server victoriametrics
 â‹® 
 â— Running query with the param:
 â‹®  {
 â‹®    "query": "kube_pod_status_phase{pod=~\"omada-central.*\", namespace=~\"sdn5\"}"
 â‹®  }

 â‹® 
 â— Completed in 0.813s

json
{
  "root_cause": "Metrics collection failure for omada-central container in sdn5 namespace - no CPU usage or resource limit data available despite alert firing",
  "evidence": [
    "Alert expression query returns empty results: sum(rate(container_cpu_usage_seconds_total{container!=\"POD\",container!=\"\", container!=\"istio-proxy\", image!=\"\",pod=~\"omada-central.*\", namespace=~\"sdn5\"}[5m])) by (pod, container) / sum(kube_pod_container_resource_limits{container!=\"POD\",pod=~\"omada-central.*\", namespace=~\"sdn5\", resource=\"cpu\"} > 0) by (pod, container)",
    "No container_cpu_usage_seconds_total metrics found for omada-central pods in sdn5 namespace",
    "No kube_pod_container_resource_limits metrics found for omada-central pods in sdn5 namespace",
    "Pod status metrics also unavailable: kube_pod_status_phase query returns empty for omada-central in sdn5",
    "Multiple omada-central services are running in other namespaces (omada-central, staging-omada-central, uat3-omada-central) with healthy 'up' status, but sdn5 namespace shows no metrics"
  ],
  "confidence": 0.95,
  "suggested_actions": [
    "Check if metrics collection agents (node-exporter, kube-state-metrics) are running in sdn5 namespace",
    "Verify if omada-central pod actually exists in sdn5 namespace - pod may have been terminated or moved",
    "Investigate VictoriaMetrics scraping configuration for sdn5 namespace targets",
    "Check if the alert is based on stale data - the pod omada-central-5.15.16041-56f89cbc98-vxbzh may no longer exist"
  ],
  "analysis_summary": "Alert indicates high CPU usage (0.92 > 0.9 threshold) for omada-central container, but comprehensive metrics queries show no data available for the target pod/namespace combination. This suggests either a metrics collection issue, pod termination, or stale alert data. The absence of both CPU metrics and pod status metrics points to a fundamental monitoring gap rather than an actual resource constraint."
}
