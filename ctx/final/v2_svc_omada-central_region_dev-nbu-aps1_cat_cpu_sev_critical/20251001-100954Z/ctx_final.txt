### AIOps reusable context
- service: omada-central
- region: dev-nbu-aps1
- category: cpu
- severity: critical
- title: omada-central container CPU usage is too high
- duration: 15m
- window: 5m
- threshold: 0.9

#### SOP (selected)
### [SOP] Preloaded knowledge (high priority)
#### CPU 告警处理
- Precheck: 使用 victoriametrics MCP 查询: sum(rate(container_cpu_usage_seconds_total{container!="POD",container!="", container!="istio-proxy", image!="",pod=~"omada-central.*", namespace=~"sdn5"}[5m])) by (pod, container) / sum(kube_pod_container_resource_limits{container!="POD",pod=~"omada-central.*", namespace=~"sdn5", resource="cpu"} > 0) by (pod, container)>0.9 (告警自带表达式)
- Precheck: 使用 awslabseks_mcp_server 检查 Pod 状态和资源限制
- Action: 1. 扩容 Pod 数量
- Action: 2. 增加 CPU 资源限制
- Action: 3. 检查是否有异常进程
- Note: CPU 使用率过高时的处理步骤
#### CloudWatch 指标检查
- Precheck: 使用 awslabscloudwatch_mcp_server 查看 AWS 资源指标
- Action: 1. 对比 CloudWatch 和 K8s 指标
- Action: 2. 检查 AWS 资源健康状况
- Action: 3. 分析跨云指标差异
- Note: CloudWatch 指标监控和对比

#### Model Output (cleaned)
I'll analyze this CPU alert for the omada-central container by executing the necessary prechecks and gathering comprehensive data.


🛠️  Using tool: query (trusted) from mcp server victoriametrics
 ⋮ 
 ● Running query with the param:
 ⋮  {
 ⋮    "query": "sum(rate(container_cpu_usage_seconds_total{container!=\"POD\",container!=\"\", container!=\"istio-proxy\", image!=\"\",pod=~\"omada-central.*\", namespace=~\"sdn5\"}[5m])) by (pod, container) / sum(kube_pod_container_resource_limits{container!=\"POD\",pod=~\"omada-central.*\", namespace=~\"sdn5\", resource=\"cpu\"} > 0) by (pod, container)"
 ⋮  }

 ⋮ 
 ● Completed in 0.37s




🛠️  Using tool: query (trusted) from mcp server victoriametrics
 ⋮ 
 ● Running query with the param:
 ⋮  {
 ⋮    "query": "container_cpu_usage_seconds_total{container=\"omada-central\", namespace=\"sdn5\"}"
 ⋮  }

 ⋮ 
 ● Completed in 0.80s




🛠️  Using tool: query (trusted) from mcp server victoriametrics
 ⋮ 
 ● Running query with the param:
 ⋮  {
 ⋮    "query": "up{job=~\".*omada.*\"}"
 ⋮  }

 ⋮ 
 ● Completed in 0.8s




🛠️  Using tool: query (trusted) from mcp server victoriametrics
 ⋮ 
 ● Running query with the param:
 ⋮  {
 ⋮    "query": "kube_pod_container_resource_limits{container=\"omada-central\", namespace=\"sdn5\", resource=\"cpu\"}"
 ⋮  }

 ⋮ 
 ● Completed in 0.2s




🛠️  Using tool: metrics (trusted) from mcp server victoriametrics
 ⋮ 
 ● Running metrics with the param:
 ⋮  {
 ⋮    "match": "{namespace=\"sdn5\"}",
 ⋮    "limit": 50
 ⋮  }

 ⋮ 
 ● Completed in 0.118s

json
{
  "root_cause": "Alert data indicates stale metrics - no current CPU usage data found for omada-central container in sdn5 namespace, suggesting monitoring system data collection issues or pod restart/termination",
  "evidence": [
    "Original alert expression returned empty results when queried against VictoriaMetrics",
    "No container_cpu_usage_seconds_total metrics found for omada-central container in sdn5 namespace", 
    "No kube_pod_container_resource_limits metrics found for omada-central in sdn5 namespace",
    "Multiple omada-central pods found running in other namespaces (uat3-omada-central, omada-central, staging-omada-central) but none in sdn5",
    "Metrics list shows container_cpu_usage_seconds_total exists in sdn5 namespace but no data for omada-central container"
  ],
  "confidence": 0.85,
  "suggested_actions": [
    "Check if omada-central pod exists in sdn5 namespace using kubectl get pods -n sdn5",
    "Verify pod status and recent restarts with kubectl describe pod omada-central-5.15.16041-56f89cbc98-vxbzh -n sdn5",
    "Investigate monitoring agent (cadvisor/node-exporter) health on the node hosting the pod",
    "Review VictoriaMetrics ingestion logs for any scraping errors from sdn5 namespace"
  ],
  "analysis_summary": "Executed comprehensive metric queries to validate the CPU alert. Found that the alert expression returns no data, indicating the omada-central container metrics are not being collected in the sdn5 namespace. This suggests either the pod has been terminated/restarted or there are monitoring collection issues. The alert appears to be based on stale data."
}
